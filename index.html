<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

</head>
<link href="DataTables/datatables.min.css" rel="stylesheet">
<link href="overlay.css" rel="stylesheet">

<script src="DataTables/datatables.min.js"></script>
<script type="module" src="https://md-block.verou.me/md-block.js"></script>
<script src="readmore-js/readmore.min.js" defer></script>

<body>

<table id="example" class="display">
    <thead>
    <tr>
        <th>title</th>
        <th>requires steamodded</th>
        <th>requires talisman</th>
        <th>categories</th>
        <th>author</th>
        <th>repo</th>
        <th>download url</th>
        <th>version</th>
        <th>description</th>
    </tr>
    </thead>
    <tfoot>
    <tr>
        <th>title</th>
        <th>requires steamodded</th>
        <th>requires talisman</th>
        <th>categories</th>
        <th>author</th>
        <th>repo</th>
        <th>download url</th>
        <th>version</th>
        <th>description</th>
    </tr>
    </tfoot>
</table>

<script>
    let table = new DataTable('#example', {
        // initComplete: function () {
        //     this.api()
        //         .rows()
        //         .every( function (rowIdx, tableLoop, rowLoop) {
        //             let row = this
        //             row.node().addEventListener('click', function () {
        //                 overlayOn(row)
        //         })
        //     })
        // },
        fixedHeader: true,
        ajax: {
            url: 'mod_list.json',
            dataSrc: 'mods'},
        columns: [
            { data: 'title'},
            { data: 'requires-steamodded',
                render: function (data, type) {
                    if (type === 'display') {
                        if (data === true) {
                            return '&#9989';
                        }
                        if (data === false) {
                            return ' ';
                        }
                        else {
                            return data;
                        }
                    }
            }, searchable: false},
            { data: 'requires-talisman',
                render: function (data, type) {
                    if (type === 'display') {
                        if (data === true) {
                            return '&#9989';
                        }
                        if (data === false) {
                            return ' ';
                        }
                        else {
                            return data;
                        }
                    }
                }, searchable: false},
            { data: 'categories.[, ]'},
            { data: 'author'},
            { data: 'repo',
                render: function (data, type) {
                    if (type === 'display') {
                        return '<a href="' + data + '">Link</a>';
                    }

                    return data;
                }, searchable: false},
            { data: 'downloadURL',
                render: function (data, type) {
                    if (type === 'display') {
                        return '<a href="' + data + '">Download</a>';
                    }

                    return data;
                }, searchable: false},
            { data: 'version', searchable: false},
            { data: 'description',
                render: function (data, type, row) {
                    if (type === 'display') {
                        return '<div class="readmore"><md-block >'+ data +'</md-block></div>';
                    }
                }
            }
            ],
        layout: {
            topStart: {
                buttons: [
                    {
                        text: 'API',
                        action: function (e, dt, node, config) {

                            if (this.active() === false) {
                                this.active(true)
                                filterCategories(dt, "API")
                            } else {
                                this.active(false)
                                filterCategoriesRemove(dt, "API")
                            }
                        }
                    },
                    {
                        text: 'Content',
                        action: function (e, dt, node, config) {

                            if (this.active() === false) {
                                this.active(true)
                                filterCategories(dt, "Content")
                            } else {
                                this.active(false)
                                filterCategoriesRemove(dt, "Content")
                            }
                        }
                    },
                    {
                        text: 'Joker',
                        action: function (e, dt, node, config) {

                            if (this.active() === false) {
                                this.active(true)
                                filterCategories(dt, "Joker")
                            } else {
                                this.active(false)
                                filterCategoriesRemove(dt, "Joker")
                            }
                        }
                    },
                    {
                        text: 'Miscellaneous',
                        action: function (e, dt, node, config) {

                            if (this.active() === false) {
                                this.active(true)
                                filterCategories(dt, "Miscellaneous")
                            } else {
                                this.active(false)
                                filterCategoriesRemove(dt, "Miscellaneous")
                            }
                        }
                    },
                    {
                        text: 'Quality of Life',
                        action: function (e, dt, node, config) {

                            if (this.active() === false) {
                                this.active(true)
                                filterCategories(dt, "Quality of Life")
                            } else {
                                this.active(false)
                                filterCategoriesRemove(dt, "Quality of Life")
                            }
                        }
                    },
                    {
                        text: 'Resource Packs',
                        action: function (e, dt, node, config) {

                            if (this.active() === false) {
                                this.active(true)
                                filterCategories(dt, "Resource Packs")
                            } else {
                                this.active(false)
                                filterCategoriesRemove(dt, "Resource Packs")
                            }
                        }
                    },
                    {
                        text: 'Technical',
                        action: function (e, dt, node, config) {

                            if (this.active() === false) {
                                this.active(true)
                                filterCategories(dt, "Technical")
                            } else {
                                this.active(false)
                                filterCategoriesRemove(dt, "Technical")
                            }
                        }
                    }
                ]
            }
        }
    })

    var filteredCategories = []

    function filterCategories(table, category) {
        filteredCategories.push('"'+category+'"');
        table.columns('categories:title').search(filteredCategories.join(" ")).draw()
    }

    function filterCategoriesRemove(table, category) {
        filteredCategories.pop('"'+category+'"');
        table.columns('categories:title').search(filteredCategories.join(" ")).draw()
    }

    document.addEventListener('DOMContentLoaded', function () {
        initReadMore('.readmore', {
            collapsedHeight: 150,	// Height of the collapsed block in pixels
            speed: 400,				// Animation duration in milliseconds
            moreLink: '<span>Read More</span>',	// Expand button text
            lessLink: '<span>Collapse</span>'	// Collapse button text
        });
    });

    table.on('click', 'tbody tr', function () {
        let row = table.row(this);
        overlayOn(row)
    })

</script>

<div id="overlay">
    <div id="overlay-background" class="overlay-container">

        <div id="overlay-name" class="overlay-child"></div>
        <div id="overlay-author" class="overlay-child"></div>
        <div id="overlay-description" class="overlay-child">

        </div>



    </div>
</div>

<script src="overlay.js"></script>

<footer style=" padding-bottom: 2%; font-size: larger">
    Website created using data from <a href="https://github.com/skyline69/balatro-mod-index">Balatro Mod Index</a> by skyline 69/Efe. Huge thanks to them for putting that together, something like this would be impossible without it!
</footer>
</body>
</html>